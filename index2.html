<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <div>
        <h1>Video Conferencing</h1>
        <div>
            <p>Your Peer ID: <span id="peerId"></span></p>
            <p>Your Friend Peer ID: <input type="text" name="" id="friendId"><button onclick="videoConnet()">Connect</button></p>
            <video id="myVideo" autoplay controls></video>
            <video id="friendVideo" autoplay controls></video>
        </div>
    </div>
    <script src="https://unpkg.com/peerjs@1.5.4/dist/peerjs.min.js"></script>
    
        

<script>
    let peerId = document.getElementById('peerId');
    var peerID = prompt("Enter your Peer ID:");
    var myVideo = document.getElementById('myVideo');
    var fvideo = document.getElementById('friendVideo');
    var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

    var peer = new Peer(peerID);
    console.log(peer);

    peerId.innerText = peerID;

   

    // Make a call
    function videoConnet(){
        var fid = document.getElementById('friendId').value; // ✅ fix: get latest friend ID
        getUserMedia({video: true, audio: true}, function(stream){
            var call = peer.call(fid,stream);
            myVideo.srcObject = stream; // ✅ show my own video
            call.on('stream', function(remoteStream) {
                fvideo.srcObject = remoteStream;
            });
        }, function(err) {
            console.log('Failed to get local stream' ,err);
        });
    }

    // Receive a call
    peer.on('call', function(call) {
        getUserMedia({video: true, audio: true}, function(stream){
            call.answer(stream); // ✅ fixed
            myVideo.srcObject = stream; // ✅ show my own video
            call.on('stream', function(remoteStream) {
                fvideo.srcObject = remoteStream;
            });
        }, function(err) {
            console.log('Failed to get local stream' ,err);
        });
    });
</script>


<!-- <script>
        

        let peerId = document.getElementById('peerId');
        var peerID = prompt("Enter your Peer ID:");
        var fid = document.getElementById('friendId').value;
        var myVideo = document.getElementById('myVideo');
        var fvideo = document.getElementById('friendVideo');
        var getUserMedia = navigator.getUserMedia;
        var peer = new Peer(peerID);
        console.log(peer);

        peerId.innerText = peerID;
        peer.on('connection', function(conn) {
            conn.on('data', function(data){
                console.log(data);
            });
        });

        function videoConnet(){
            getUserMedia({video: true, audio: true}, function(stream){
                var call = peer.call(fid,stream);
                myVideo.srcObject = stream;
                call.on('stream', function(remoteStream) {
                    fvideo.srcObject = remoteStream;
                    
                });
            }, function(err) {
                console.log('Failed to get local stream' ,err);
            });
        }


        peer.on('call', function(call) {
            call.answer(Stream);
            getUserMedia({video: true, audio: true}, function(stream){
                call.on('stream', function(remoteStream) {
                    fvideo.srcObject = remoteStream;
                    myVideo.srcObject = remoteStream;
                });
            }, function(err) {
                console.log('Failed to get local stream' ,err);
            });
        });
        
        
    </script> -->

        

</body>
</html>